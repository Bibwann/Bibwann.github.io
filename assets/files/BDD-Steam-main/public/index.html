<!doctype html>
<!--
  ===========================================================
  Steam Games ‚Äî App Shell (HTML + Accessibility + Hooks)
  -----------------------------------------------------------
  What lives here:
  - Static structure, ARIA roles, and data-* hooks that
    the JS layer (/js/filters.js) reads and manipulates.
  - Filter controls (selects, ranges, buttons) identified
    by IDs/classes that the JS queries (getElementById /
    querySelector) to build the search payload.

  How it ties to the JS you saw:
  - #profile-select persists to localStorage (PROFILE_KEY)
    and forces a reload so the backend responds per-profile.
  - .main-nav .nav-btn[data-category] drives "category", used
    by runSearch() to switch "all / favorites / recommendations / goty".
  - #search-input is debounced and feeds "filters.search".
  - .platform-btn[data-platform] toggles windows/mac/linux flags.
  - #genre-select / #language-select / #developer-select are
    populated via GET /api/games/distinct/:kind (cached).
  - #goty-year filters GOTY results; #add-goty-btn opens the modal.
  - #games-grid receives rendered game cards.
  - #pager is injected after #games-grid by renderPager().

  Accessibility:
  - Roles and aria-* attributes keep the UI screen-reader friendly.
  - aria-live regions announce result count/updates politely.
  ===========================================================
-->
<html lang="en" data-color-scheme="dark">
<head>
  <meta charset="utf-8" />
  <!-- Responsive viewport for mobile-first layout -->
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Steam Games</title>

  <!-- Favicon and main stylesheet -->
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
  <div class="app-container">
    <!-- ========================= Header (brand + nav + quick filters) ========================= -->
    <header class="header">
      <div class="header-content">
        <div class="header-left">
          <!-- App logo/title (purely visual) -->
          <div class="logo">
            <h1>STEAM GAMES</h1>
          </div>

          <!--
            Main nav:
            - Buttons use data-category so JS can read which logical "tab" is active.
            - JS toggles the "active" class and re-runs runSearch().
            - Categories:
              ‚Ä¢ all              -> default search
              ‚Ä¢ favorites        -> appids loaded from localStorage per profile
              ‚Ä¢ recommendations  -> backend recommends based on current favorites
              ‚Ä¢ goty             -> GOTY-specific filters and modal available
          -->
          <nav class="main-nav" aria-label="Main categories">
            <button class="nav-btn active" data-category="all" type="button">All Games</button>
            <button class="nav-btn" data-category="favorites" type="button">Favorites</button>
            <button class="nav-btn" data-category="recommendations" type="button">Recommendations For You</button>
            <button class="nav-btn" data-category="goty" type="button">GOTY</button>
          </nav>
        </div>

        <div class="header-right">
          <!--
            Search box:
            - JS listens to #search-input (debounced) and updates filters.search.
            - role="search" improves semantics for assistive tech.
          -->
          <div class="search-container" role="search">
            <input id="search-input" type="search" placeholder="Search games or developers..." aria-label="Search" />
            <span class="search-icon">üîé</span>
          </div>

          <!--
            Profile switcher:
            - The <select> initial "selected" is a visual default.
            - On load, JS replaces it with CURRENT_PROFILE from localStorage
              and persists any change under PROFILE_KEY, then reloads the page
              so backend data and UI tabs reflect the new profile.
          -->
          <div class="profile-switcher" title="Current profile">
            <label for="profile-select">Profile:</label>
            <select id="profile-select" class="form-control">
              <option value="kid">Kid</option>
              <option value="person1" selected>Person 1</option>
              <option value="person2">Person 2</option>
            </select>
          </div>

          <!--
            Platforms quick filters:
            - Each button toggles .active and contributes to filters.platforms.
            - data-platform ‚àà {"windows","mac","linux"} ‚Äî read by getActivePlatforms().
          -->
          <div class="platform-filters" aria-label="Platforms">
            <button class="platform-btn" data-platform="windows" title="Windows" type="button">ü™ü</button>
            <button class="platform-btn" data-platform="mac" title="macOS" type="button">üçé</button>
            <button class="platform-btn" data-platform="linux" title="Linux" type="button">üêß</button>
          </div>
        </div>
      </div>
    </header>

    <!-- ========================= Secondary filters bar =========================
         All controls here are read by the JS (get* helpers) to assemble filters. -->
    <section class="secondary-bar" aria-label="Filters">
      <div class="secondary-content">
        <!-- Sort order (maps to getSortValue() -> filters.sort) -->
        <div class="filter-group">
          <label for="sort-select">Sort by:</label>
          <select id="sort-select" class="form-control">
            <option value="name-asc">Name (A‚ÄìZ)</option>
            <option value="name-desc">Name (Z‚ÄìA)</option>
            <option value="price-asc">Price (Low ‚Üí High)</option>
            <option value="price-desc">Price (High ‚Üí Low)</option>
            <option value="date-desc">Release date (New ‚Üí Old)</option>
            <option value="date-asc">Release date (Old ‚Üí New)</option>
            <option value="rating-desc">Rating</option>
          </select>
        </div>

        <!-- Genre filter:
             - Options are populated at runtime from /api/games/distinct/genres.
             - For "kid" profile, JS additionally hides adult genres client-side. -->
        <div class="filter-group">
          <label for="genre-select">Genre:</label>
          <select id="genre-select" class="form-control">
            <option value="">All Genres</option>
          </select>
        </div>

        <!-- Language filter (populated from /distinct/languages) -->
        <div class="filter-group">
          <label for="language-select">Language:</label>
          <select id="language-select" class="form-control">
            <option value="">All Languages</option>
          </select>
        </div>

        <!-- Multiplayer mode (single/multi) -->
        <div class="filter-group">
          <label for="multiplayer-select">Player Mode:</label>
          <select id="multiplayer-select" class="form-control">
            <option value="">All Modes</option>
            <option value="single">Single-player</option>
            <option value="multi">Multi-player</option>
          </select>
        </div>

        <!-- Developer list (populated from /distinct/developers; trimmed, unique, capped) -->
        <div class="filter-group" style="min-width:260px; flex:1">
          <label for="developer-select">Developer:</label>
          <select id="developer-select" class="form-control">
            <option value="">All Developers</option>
          </select>
        </div>

        <!--
          Price range sliders (min/max):
          - JS keeps min <= max, updates the visible label #price-value,
            and triggers runSearch() on change.
        -->
        <div class="filter-group" style="min-width:260px">
          <label>Price Range: <span id="price-value">0-50</span></label>
          <div class="price-range" aria-label="Price range">
            <input id="price-min" type="range" min="0" max="50" step="1" value="0" class="range-slider" aria-label="Min price" />
            <input id="price-max" type="range" min="0" max="50" step="1" value="50" class="range-slider" aria-label="Max price" />
          </div>
        </div>

        <!--
          GOTY-only controls:
          - These blocks are hidden by default and shown by JS when the
            active category is "goty" (see setCategoryActive()).
          - #goty-year filters existing GOTY entries.
          - #add-goty-btn opens a modal with typeahead to set a GOTY.
        -->
        <div class="filter-group goty-filter" style="display:none; min-width:220px;">
          <label for="goty-year">GOTY year filter:</label>
          <select id="goty-year" class="form-control">
            <option value="">All years</option>
          </select>
        </div>

        <div class="filter-group goty-filter" style="display:none; align-items:flex-end; min-width:140px;">
          <label>&nbsp;</label>
          <button id="add-goty-btn" class="btn btn--primary" type="button">Add GOTY</button>
        </div>

        <!--
          Recommendations seed (optional extension):
          - This input (French label) can be used to specify a seed appid.
          - Currently hidden (display:none). You could show it when
            category === "recommendations" if you want to support manual seeding.
        -->
        <div class="filter-group recos-filter" style="display:none; min-width:240px;">
          <label for="seed-appid">Jeu de r√©f√©rence (appid) :</label>
          <input id="seed-appid" class="form-control" type="text" placeholder="ex: 1026420" />
        </div>
      </div>
    </section>

    <!-- ============================== Main content ============================== -->
    <main class="main-content">
      <div class="content-header">
        <!-- Title can be updated by JS when categories change -->
        <h2 id="content-title">All Games</h2>
        <div class="content-actions">
          <!-- Updated by renderCount(n) after each search -->
          <span id="results-count">0 games found</span>
        </div>
      </div>

      <!--
        Global loading overlay:
        - setLoading(true/false) toggles display.
        - aria-hidden on spinner is okay as text is also present.
      -->
      <div id="loading" class="loading" style="display:none;">
        <div class="spinner" aria-hidden="true"></div>
        <div>Loading‚Ä¶</div>
      </div>

      <!--
        "No results" empty state:
        - showNoResults(true/false) toggles visibility.
        - JS may also inject a custom message for Recommendations when no favorites exist.
      -->
      <div id="no-results" class="no-results" style="display:none;">
        <div class="no-results-icon">üéÆ</div>
        <h3>No games found</h3>
        <p>Try adjusting your filters or search terms.</p>
      </div>

      <!--
        Results grid:
        - renderGames(items) fills this container with card HTML.
        - aria-live="polite" lets screen readers know content changed
          without interrupting the user; aria-busy toggling is optional.
      -->
      <div id="games-grid" class="games-grid" aria-live="polite" aria-busy="false"></div>
    </main>
  </div>

  <!--
    Toast container:
    - toast(msg) appends transient messages here.
    - aria-live/aria-atomic make screen readers announce them.
  -->
  <div id="toaster" class="toaster" aria-live="polite" aria-atomic="true"></div>

  <!--
    Main JS bundle:
    - Contains all event wiring, search flow, GOTY modal, favorites,
      pagination, and distinct lists loading.
    - 'defer' ensures the script runs after parsing HTML.
  -->
  <script src="/js/filters.js" defer></script>

  <!--
    Inline helper:
    - Populates the GOTY year <select> with [currentYear..1990]
      on DOMContentLoaded so it's immediately available if user
      lands directly on the GOTY tab.
    - The main JS also reads #goty-year to filter results.
  -->
  <script>
    // Fill GOTY year filter on load
    document.addEventListener("DOMContentLoaded", () => {
      const sel = document.getElementById("goty-year");
      if (sel) {
        const now = new Date().getFullYear();
        const years = Array.from({length: now - 1989}, (_, i) => now - i);
        sel.insertAdjacentHTML(
          "beforeend",
          years.map(y => `<option value="${y}">${y}</option>`).join("")
        );
      }
    });
  </script>
</body>
</html>
