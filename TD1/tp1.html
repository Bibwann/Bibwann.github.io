<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Geolocalisation avec Bootstrap et Leaflet</title>

  <!--  pour que ce soit pas moche -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <link rel="stylesheet" href="style.css">
  
</head>
<body class="container py-4">
  <h1 class="mb-4 text-center">Exercice Geolocalisation</h1>

  <div class="row g-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Informations</h5>
          <ul class="list-group list-group-flush mb-3">
            <li class="list-group-item">Latitude: <span id="lat">-</span></li>
            <li class="list-group-item">Longitude: <span id="lon">-</span></li>
            <li class="list-group-item">Altitude: <span id="alt">-</span></li>
            <li class="list-group-item">Precision: <span id="acc">-</span></li>
            <li class="list-group-item">Vitesse: <span id="spd">-</span></li>
            <li class="list-group-item">Date: <span id="ts">-</span></li>
          </ul>
          <div class="d-grid gap-2">
            <button id="btnSingle" class="btn btn-outline-primary">üìç Position unique</button>
            <button id="btnStart" class="btn btn-outline-success">‚ñ∂Ô∏è Demarrer surveillance</button>
            <button id="btnStop" class="btn btn-outline-danger" disabled>‚èπÔ∏è Arreter surveillance</button>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title mb-3">Carte</h5>
          <div id="map"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let watchId = null;
    let map, marker, circle;

    function initMap(lat, lon, acc){
      if (!map){
        map = L.map('map').setView([lat, lon], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: '&copy; OpenStreetMap'
        }).addTo(map);
        marker = L.marker([lat, lon]).addTo(map);
        circle = L.circle([lat, lon], { radius: acc }).addTo(map);

        setTimeout(() => { map.invalidateSize(); }, 300);
      } else {
        marker.setLatLng([lat, lon]);
        circle.setLatLng([lat, lon]);
        circle.setRadius(acc);
        map.setView([lat, lon]);
        map.invalidateSize();
      }
    }

    function showPosition(pos){
      document.getElementById('lat').textContent = pos.coords.latitude;
      document.getElementById('lon').textContent = pos.coords.longitude;
      document.getElementById('alt').textContent = pos.coords.altitude || 'non dispo';
      document.getElementById('acc').textContent = pos.coords.accuracy;
      document.getElementById('spd').textContent = pos.coords.speed || 'non dispo';
      document.getElementById('ts').textContent = new Date(pos.timestamp).toLocaleString();
      initMap(pos.coords.latitude, pos.coords.longitude, pos.coords.accuracy);
    }

    function getPosition(){
      if (navigator.geolocation){
        navigator.geolocation.getCurrentPosition(showPosition);
      } else {
        alert('geolocation non supportee');
      }
    }

    function startWatch(){
      if (navigator.geolocation && watchId === null){
        watchId = navigator.geolocation.watchPosition(showPosition);
        document.getElementById('btnStart').disabled = true;
        document.getElementById('btnStop').disabled = false;
      }
    }

    function stopWatch(){
      if (watchId !== null){
        navigator.geolocation.clearWatch(watchId);
        watchId = null;
        document.getElementById('btnStart').disabled = false;
        document.getElementById('btnStop').disabled = true;
      }
    }

    document.getElementById('btnSingle').addEventListener('click', getPosition);
    document.getElementById('btnStart').addEventListener('click', startWatch);
    document.getElementById('btnStop').addEventListener('click', stopWatch);
  </script>
</body>
</html>